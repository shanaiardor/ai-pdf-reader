<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Box Explorer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Fraunces:opsz,wght@9..144,500&display=swap" />
  <link rel="stylesheet" href="/src/style.css" />
</head>

<body class="h-screen overflow-hidden">
  <header id="app-header" class="flex flex-wrap items-center justify-between gap-4 px-6 py-6 lg:px-8">
    <div id="header-brand" class="flex items-center gap-4">
      <div class="h-4 w-4 rounded-full bg-accent shadow-[0_0_0_6px_rgba(255,122,26,0.2)]"></div>
      <div>
        <div class="font-fraunces text-[22px] tracking-wide">PDF Box Explorer</div>
        <div class="text-xs text-neutral-500">Render • Extract • Inspect</div>
      </div>
    </div>
    <div id="header-controls" class="flex flex-wrap items-center gap-2">
      <div
        class="flex items-center gap-1 rounded-full border border-black/10 bg-white/60 px-3 py-1 shadow-[0_8px_18px_rgba(15,20,30,0.06)]">
        <input id="search-input" class="w-44 bg-transparent px-2 py-1 text-sm outline-none placeholder:text-neutral-400"
          placeholder="Search" aria-label="Search within current page" />
        <button id="search-prev-btn" class="rounded-full px-2 py-1 text-sm transition hover:bg-black/5" type="button"
          title="上一个匹配 (Shift+Enter)">↑</button>
        <button id="search-next-btn" class="rounded-full px-2 py-1 text-sm transition hover:bg-black/5" type="button"
          title="下一个匹配 (Enter)">↓</button>
      </div>

      <div
        class="flex items-center gap-1 rounded-full border border-black/10 bg-white/60 px-2 py-1 shadow-[0_8px_18px_rgba(15,20,30,0.06)]">
        <button id="prev-btn" class="rounded-full px-3 py-1 text-sm transition hover:bg-black/5" type="button"
          title="上一页 (←/PageUp)">←</button>
        <div class="flex items-center gap-1 text-sm">
          <input id="page-input"
            class="w-[4ch] rounded-lg border border-black/10 bg-white/70 px-2 py-1 text-center text-sm outline-none focus:border-black/30"
            inputmode="numeric" aria-label="Page number" />
          <span class="text-neutral-500">/</span>
          <span id="page-total" class="min-w-[4ch] text-neutral-500">—</span>
        </div>
        <button id="next-btn" class="rounded-full px-3 py-1 text-sm transition hover:bg-black/5" type="button"
          title="下一页 (→/PageDown)">→</button>
      </div>

      <div
        class="flex items-center gap-1 rounded-full border border-black/10 bg-white/60 px-2 py-1 shadow-[0_8px_18px_rgba(15,20,30,0.06)]">
        <button id="zoom-out-btn" class="rounded-full px-3 py-1 text-sm transition hover:bg-black/5" type="button"
          title="缩小 (-)">−</button>
        <div id="zoom-label" class="min-w-[5ch] text-center text-sm text-neutral-600" title="当前缩放">—</div>
        <button id="zoom-in-btn" class="rounded-full px-3 py-1 text-sm transition hover:bg-black/5" type="button"
          title="放大 (+)">＋</button>
        <button id="fit-width-btn" class="rounded-full px-3 py-1 text-sm transition hover:bg-black/5" type="button"
          title="适配宽度 (F)">适配</button>
      </div>

      <button id="mode-btn"
        class="rounded-full border border-black/10 bg-white/60 px-4 py-2 text-sm shadow-[0_8px_18px_rgba(15,20,30,0.06)] transition hover:-translate-y-0.5"
        type="button" title="切换阅读模式 (M)">单页</button>
      <button id="theme-btn"
        class="rounded-full border border-black/10 bg-white/60 px-4 py-2 text-sm shadow-[0_8px_18px_rgba(15,20,30,0.06)] transition hover:-translate-y-0.5"
        type="button" title="切换主题 (T)">浅色</button>
      <button id="ai-config-btn"
        class="rounded-full border border-black/10 bg-white/60 px-4 py-2 text-sm shadow-[0_8px_18px_rgba(15,20,30,0.06)] transition hover:-translate-y-0.5"
        type="button" title="配置">配置</button>


      <label id="load-pdf-btn"
        class="cursor-pointer rounded-full bg-accent px-4 py-2 text-sm text-white shadow-[0_8px_18px_rgba(255,122,26,0.25)] transition hover:-translate-y-0.5 hover:shadow-[0_10px_20px_rgba(255,122,26,0.32)]">
        <input id="file-input" class="hidden" type="file" accept="application/pdf" aria-label="Open PDF file" />
        Load PDF
      </label>
      <button id="clear-btn"
        class="rounded-full border border-black/10 px-4 py-2 text-sm transition hover:-translate-y-0.5">关闭PDF</button>
    </div>
  </header>

  <main
    class="mx-auto grid h-[calc(100vh-96px)] w-full max-w-[1400px] grid-cols-1 gap-6 px-6 pb-6 lg:grid-cols-[minmax(0,2.2fr)_minmax(280px,1fr)] lg:px-8 lg:pb-8">
    <section class="surface-soft relative overflow-y-auto rounded-3xl p-5 shadow-card" id="viewer">
      <div class="flex h-full items-center justify-center" id="viewer-empty">
        <div class="surface rounded-2xl p-9 text-center shadow-[0_12px_30px_rgba(15,20,30,0.1)]">
          <div class="text-lg font-semibold">Drop in a PDF</div>
          <div class="mt-2 text-sm text-neutral-500">Choose a PDF to render pages and generate clickable text boxes.
          </div>
        </div>
      </div>
    </section>

    <aside class="surface flex min-h-0 flex-col rounded-3xl p-6 shadow-card">
      <div id="selection-title" class="font-fraunces text-lg">Selection</div>
      <div class="scroll-area mt-3 flex-1 space-y-4 overflow-y-auto pr-2">
        <div id="selection-summary" class="surface-soft collapsible rounded-2xl p-4 text-sm">
          <div class="text-xs uppercase tracking-[0.2em] text-neutral-500">Selected (0)</div>
          <div id="selection-text" class="mt-2 text-base">—</div>
          <div id="ai-analysis-status" class="mt-3 text-xs text-neutral-500">使用右上角 AI 配置填写接口信息。</div>
        </div>

        <div id="ai-analyze-wrap" class="collapsible flex flex-wrap gap-2">
          <button id="ai-analyze-btn"
            class="rounded-full bg-accent px-4 py-2 text-sm text-white shadow-[0_8px_18px_rgba(255,122,26,0.25)] transition hover:-translate-y-0.5 hover:shadow-[0_10px_20px_rgba(255,122,26,0.32)]"
            type="button">AI 分析</button>
        </div>

        <div>
          <button id="ai-instruction-toggle"
            class="flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-neutral-500 transition hover:text-neutral-700"
            type="button">
            AI Instruction
            <span class="text-[10px]">▾</span>
          </button>
          <div id="ai-instruction-panel" class="collapsible">
            <textarea id="ai-instruction"
              class="surface-soft mt-2 w-full rounded-2xl p-3 text-sm outline-none focus:outline-none" rows="4"
              placeholder="例如：用中文解释这段内容，并给出要点。" aria-label="AI instruction"></textarea>
            <div class="mt-2 text-xs text-neutral-500">
              提示：用于 AI 分析的系统提示词，可在右上角配置 OpenAI 兼容接口。
            </div>
          </div>
        </div>

        <div>
          <div class="text-xs uppercase tracking-[0.2em] text-neutral-500">AI 分析结果</div>
          <div id="ai-analysis-output" class="surface-soft markdown mt-2 rounded-2xl p-3 text-sm text-neutral-700">—
          </div>
        </div>


      </div>
    </aside>
  </main>

  <div id="ai-config-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 px-4 backdrop-blur-sm">
    <div class="surface w-full max-w-xl rounded-3xl p-6 shadow-card">
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="font-fraunces text-lg">配置</div>
          <div class="mt-1 text-xs text-neutral-500">OpenAI 兼容接口与显示选项。</div>
        </div>
        <button id="ai-config-close" class="rounded-full px-2 py-1 text-sm transition hover:bg-black/5" type="button"
          aria-label="Close">✕</button>
      </div>

      <form id="ai-config-form" class="mt-5 space-y-4">
        <div>
          <label class="text-xs uppercase tracking-[0.2em] text-neutral-500" for="ai-config-model">Model</label>
          <input id="ai-config-model" class="surface-soft mt-2 w-full rounded-2xl px-3 py-2 text-sm outline-none"
            placeholder="gpt-4o-mini" />
        </div>
        <div>
          <label class="text-xs uppercase tracking-[0.2em] text-neutral-500" for="ai-config-base-url">Base URL</label>
          <input id="ai-config-base-url" class="surface-soft mt-2 w-full rounded-2xl px-3 py-2 text-sm outline-none"
            placeholder="https://api.openai.com/v1" />
        </div>
        <div>
          <label class="text-xs uppercase tracking-[0.2em] text-neutral-500" for="ai-config-api-key">API Key</label>
          <input id="ai-config-api-key" class="surface-soft mt-2 w-full rounded-2xl px-3 py-2 text-sm outline-none"
            type="password" placeholder="sk-..." />
        </div>
        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="text-xs uppercase tracking-[0.2em] text-neutral-500"
              for="ai-config-temperature">Temperature</label>
            <input id="ai-config-temperature"
              class="surface-soft mt-2 w-full rounded-2xl px-3 py-2 text-sm outline-none" type="number" min="0" max="2"
              step="0.1" placeholder="0.2" />
          </div>
          <div>
            <label class="text-xs uppercase tracking-[0.2em] text-neutral-500" for="ai-config-max-tokens">Max
              Tokens</label>
            <input id="ai-config-max-tokens" class="surface-soft mt-2 w-full rounded-2xl px-3 py-2 text-sm outline-none"
              type="number" min="1" step="1" placeholder="1024" />
          </div>
        </div>
        <div class="flex items-center justify-between gap-3 rounded-2xl border border-black/10 bg-white/50 px-4 py-3">
          <div>
            <div class="text-xs uppercase tracking-[0.2em] text-neutral-500">文字格子</div>
            <div class="mt-1 text-sm text-neutral-600">显示/隐藏渲染在文字上的格子（不影响选择功能）。</div>
          </div>
          <label class="flex items-center gap-2 text-sm">
            <input id="ai-config-show-boxes" type="checkbox" class="h-4 w-4 accent-[rgb(255,122,26)]" />
            显示
          </label>
        </div>
        <div class="text-xs text-neutral-500" id="ai-config-status">配置会保存到应用的配置目录。</div>
        <div class="flex flex-wrap items-center justify-end gap-2">
          <button id="ai-config-cancel"
            class="surface-soft rounded-full px-4 py-2 text-sm transition hover:-translate-y-0.5"
            type="button">取消</button>
          <button id="ai-config-save"
            class="rounded-full bg-accent px-4 py-2 text-sm text-white shadow-[0_8px_18px_rgba(255,122,26,0.25)] transition hover:-translate-y-0.5 hover:shadow-[0_10px_20px_rgba(255,122,26,0.32)]"
            type="submit">保存</button>
        </div>
      </form>
    </div>
  </div>

  <div id="last-open-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 px-4 backdrop-blur-sm">
    <div class="surface w-full max-w-lg rounded-3xl p-6 shadow-card">
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="font-fraunces text-lg">打开上次文件？</div>
          <div class="mt-1 text-xs text-neutral-500">检测到上次打开的 PDF。</div>
        </div>
        <button id="last-open-close" class="rounded-full px-2 py-1 text-sm transition hover:bg-black/5" type="button"
          aria-label="Close">✕</button>
      </div>
      <div id="last-open-path" class="surface-soft mt-4 rounded-2xl p-3 text-sm text-neutral-600"></div>
      <div class="mt-5 flex flex-wrap items-center justify-end gap-2">
        <button id="last-open-cancel"
          class="surface-soft rounded-full px-4 py-2 text-sm transition hover:-translate-y-0.5"
          type="button">取消</button>
        <button id="last-open-open"
          class="rounded-full bg-accent px-4 py-2 text-sm text-white shadow-[0_8px_18px_rgba(255,122,26,0.25)] transition hover:-translate-y-0.5 hover:shadow-[0_10px_20px_rgba(255,122,26,0.32)] disabled:cursor-not-allowed disabled:opacity-70"
          type="button">
          <span class="last-open-label">打开</span>
          <span
            class="last-open-spinner hidden h-4 w-4 animate-spin rounded-full border-2 border-white/40 border-t-white/90"
            aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/app.js"></script>
</body>

</html>